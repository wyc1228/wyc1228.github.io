<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wyc1228.github.io","root":"/","scheme":"Gemini","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Cookie&amp;Session">
<meta property="og:type" content="article">
<meta property="og:title" content="Cookie&amp;Session">
<meta property="og:url" content="https://wyc1228.github.io/2020/09/23/Cookie&Session/index.html">
<meta property="og:site_name" content="wyc&#39;s blog">
<meta property="og:description" content="Cookie&amp;Session">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wyc1228.github.io/2020/09/23/Cookie&Session/cookie%E5%88%9B%E5%BB%BA.jpg">
<meta property="og:image" content="https://wyc1228.github.io/2020/09/23/Cookie&Session/cookie%E8%8E%B7%E5%8F%96.jpg">
<meta property="og:image" content="https://wyc1228.github.io/2020/09/23/Cookie&Session/session.jpg">
<meta property="article:published_time" content="2020-09-23T13:46:45.000Z">
<meta property="article:modified_time" content="2020-09-23T13:09:50.909Z">
<meta property="article:author" content="wyc">
<meta property="article:tag" content="javaweb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wyc1228.github.io/2020/09/23/Cookie&Session/cookie%E5%88%9B%E5%BB%BA.jpg">


<link rel="canonical" href="https://wyc1228.github.io/2020/09/23/Cookie&Session/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Cookie&Session | wyc's blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">wyc's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Cookie-amp-Session"><span class="nav-text">Cookie&amp;Session</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%9A%E8%AF%9D"><span class="nav-text">会话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%9A%E8%AF%9DCookie"><span class="nav-text">客户端会话Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%A6%82%E8%BF%B0"><span class="nav-text">1.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Cookie%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">1.2 Cookie的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Cookie%E5%80%BC%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-text">1.3 Cookie值的修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Cookie%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">1.4 Cookie生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-Cookie%E6%9C%89%E6%95%88%E8%B7%AF%E5%BE%84path%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="nav-text">1.5 Cookie有效路径path的设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-Cookie%E7%9A%84%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82"><span class="nav-text">1.6 Cookie的其他细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E4%BC%9A%E8%AF%9DSession"><span class="nav-text">服务器端会话Session</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%A6%82%E8%BF%B0-1"><span class="nav-text">1.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Session%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%8E%B7%E5%8F%96"><span class="nav-text">1.2 Session创建与获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Session%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">1.3 Session生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%92%8C-Session-%E4%B9%8B%E9%97%B4%E5%85%B3%E8%81%94"><span class="nav-text">1.4 浏览器和 Session 之间关联</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-Session%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82"><span class="nav-text">1.5 Session其他细节</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wyc"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">wyc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://wyc1228.github.io/2020/09/23/Cookie&Session/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="wyc">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wyc's blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Cookie&Session
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-23 21:46:45" itemprop="dateCreated datePublished" datetime="2020-09-23T21:46:45+08:00">2020-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">Cookie&Session</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Cookie-amp-Session"><a href="#Cookie-amp-Session" class="headerlink" title="Cookie&amp;Session"></a>Cookie&amp;Session</h1><h2 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h2><p>会话：一次会话中包含多次请求和响应。</p>
<p> 一次会话：浏览器第一次给服务器资源发送请求，会话建立，直到有一方断开为止</p>
<p>会话功能：在一次会话的范围内的多次请求间，共享数据</p>
<p>会话的方式：</p>
<ul>
<li><p>客户端会话技术：Cookie</p>
</li>
<li><p>服务器端会话技术：Session</p>
</li>
</ul>
<h2 id="客户端会话Cookie"><a href="#客户端会话Cookie" class="headerlink" title="客户端会话Cookie"></a>客户端会话Cookie</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>客户端会话技术，将数据保存到客户端</p>
<p>Cookie 是服务器通知客户端保存键值对的一种技术。 </p>
<p>客户端有了 Cookie 后，每次请求都发送给服务器。</p>
<p>每个 Cookie 的大小不能超过 4kb</p>
<h3 id="1-2-Cookie的创建"><a href="#1-2-Cookie的创建" class="headerlink" title="1.2 Cookie的创建"></a>1.2 Cookie的创建</h3><p>创建Cookie对象，绑定数据：<code>new Cookie(String name, String value)</code> </p>
<p>发送Cookie对象：<code>response.addCookie(Cookie cookie)</code> </p>
<p><img src="/2020/09/23/Cookie&Session/cookie%E5%88%9B%E5%BB%BA.jpg" alt="cookie创建"></p>
<pre><code class="java">public class CookieServlet extends HttpServlet &#123;
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;
        //创建cookie
        Cookie cookie = new Cookie(&quot;key1&quot;, &quot;value1&quot;);
        //通知客户端保存cookie
        response.addCookie(cookie);
    &#125;

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;
        this.doPost(request, response);
    &#125;
&#125;
</code></pre>
<p>从客户端获取cookie，拿到数据： <code>Cookie[]  request.getCookies()</code> </p>
<p><img src="/2020/09/23/Cookie&Session/cookie%E8%8E%B7%E5%8F%96.jpg" alt="cookie获取"></p>
<pre><code class="java">public class CookieDemo2 extends HttpServlet &#123;
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;
        //获取Cookie
        Cookie[] cookies = request.getCookies();

        if (cookies!=null)&#123;
            for (Cookie cookie : cookies) &#123;
                System.out.println(cookie.getName());
                System.out.println(cookie.getValue());
            &#125;
        &#125;
    &#125;

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;
        this.doPost(request, response);
    &#125;
&#125;
</code></pre>
<p>cookie工具类：查找指定名称的cookie</p>
<pre><code class="java">public class CookieUtils &#123;
    /**
     * 查找指定名称的Cookie对象
     */
    public static Cookie findCookie(String name , Cookie[] cookies)&#123;
        if (name == null || cookies == null || cookies.length == 0) &#123;
            return null;
        &#125;
        for (Cookie cookie : cookies) &#123;
            if (name.equals(cookie.getName())) &#123;
                return cookie;
            &#125;
        &#125;
        return null;
    &#125;
&#125;
</code></pre>
<p>使用：</p>
<pre><code class="java">protected void getCookie(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        Cookie[] cookies = req.getCookies();
        for (Cookie cookie : cookies) &#123;
            // getName方法返回Cookie的key（名）
            // getValue方法返回Cookie的value值
            resp.getWriter().write(&quot;Cookie[&quot; + cookie.getName() + &quot;=&quot; + cookie.getValue() + &quot;] &lt;br/&gt;&quot;);
        &#125;
        Cookie iWantCookie = CookieUtils.findCookie(&quot;key1&quot;, cookies);
//        for (Cookie cookie : cookies) &#123;
//            if (&quot;key2&quot;.equals(cookie.getName())) &#123;
//                iWantCookie = cookie;
//                break;
//            &#125;
//        &#125;
        // 如果不等于null，说明赋过值，也就是找到了需要的Cookie
        if (iWantCookie != null) &#123;
            resp.getWriter().write(&quot;找到了需要的Cookie&quot;);
        &#125;

    &#125;
</code></pre>
<h3 id="1-3-Cookie值的修改"><a href="#1-3-Cookie值的修改" class="headerlink" title="1.3 Cookie值的修改"></a>1.3 Cookie值的修改</h3><p>方案一：修改key1的值</p>
<ul>
<li>先创建一个要修改的同名的Cookie对象</li>
<li>在构造器中同时赋于新的Cookie值。</li>
<li>Cookie cookie = new Cookie(“key1”,”newValue1”);</li>
<li>调用response.addCookie( Cookie ); 通知 客户端 保存修改</li>
</ul>
<p>方案二：</p>
<ul>
<li><p>先查找到需要修改的Cookie对象</p>
</li>
<li><p>调用setValue()方法赋于新的Cookie值。</p>
</li>
<li><p>调用response.addCookie()通知客户端保存修改</p>
</li>
</ul>
<pre><code class="java">protected void updateCookie(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
//        方案一：
//        1、先创建一个要修改的同名的Cookie对象
//        2、在构造器中同时赋于新的Cookie值。
//        Cookie cookie = new Cookie(&quot;key1&quot;,&quot;newValue1&quot;);
//        3、调用response.addCookie( Cookie ); 通知 客户端 保存修改
//        resp.addCookie(cookie);

//        方案二：
//        1、先查找到需要修改的Cookie对象
        Cookie cookie = CookieUtils.findCookie(&quot;key2&quot;, req.getCookies());
        if (cookie != null) &#123;
//            2、调用setValue()方法赋于新的Cookie值。
            cookie.setValue(&quot;newValue2&quot;);
//        3、调用response.addCookie()通知客户端保存修改
            resp.addCookie(cookie);
        &#125;
        resp.getWriter().write(&quot;key1的Cookie已经修改好&quot;);
    &#125;
</code></pre>
<h3 id="1-4-Cookie生命周期"><a href="#1-4-Cookie生命周期" class="headerlink" title="1.4 Cookie生命周期"></a>1.4 Cookie生命周期</h3><p>Cookie 的生命控制指的是如何管理Cookie 什么时候被销毁（删除）</p>
<p>设置Cookie的<code>setMaxAge()</code> 方法，得到cookie对象后就设置生命周期</p>
<ul>
<li><p>正数，表示在指定的秒数后过期 </p>
</li>
<li><p>负数，表示浏览器一关，Cookie 就会被删除（默认值是-1） </p>
</li>
<li><p>零，表示马上删除 Cookie</p>
</li>
</ul>
<pre><code class="java">protected void life3600(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;

        Cookie cookie = new Cookie(&quot;life3600&quot;, &quot;life3600&quot;);
        cookie.setMaxAge(60 * 60); // 设置Cookie一小时之后被删除。无效
        resp.addCookie(cookie);
        resp.getWriter().write(&quot;已经创建了一个存活一小时的Cookie&quot;);
    
        Cookie cookie = CookieUtils.findCookie(&quot;key4&quot;, req.getCookies());
        if (cookie != null) &#123;
            // 调用setMaxAge(0);
            cookie.setMaxAge(0); // 表示马上删除，都不需要等待浏览器关闭
            // 调用response.addCookie(cookie);
            resp.addCookie(cookie);

            resp.getWriter().write(&quot;key4的Cookie已经被删除&quot;);
        &#125;
    
    
    &#125;
</code></pre>
<h3 id="1-5-Cookie有效路径path的设置"><a href="#1-5-Cookie有效路径path的设置" class="headerlink" title="1.5 Cookie有效路径path的设置"></a>1.5 Cookie有效路径path的设置</h3><p>Cookie 的 path 属性可以有效的过滤 哪些 Cookie 可以发送给服务器。哪些不能发送给服务器。 </p>
<p>path 属性是通过请求的地址来进行有效的过滤。</p>
<pre><code class="java">protected void testPath(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        Cookie cookie = new Cookie(&quot;path1&quot;, &quot;path1&quot;);
        // getContextPath() ===&gt;&gt;&gt;&gt;  得到工程路径
        cookie.setPath(req.getContextPath() + &quot;/abc&quot;); // ===&gt;&gt;&gt;&gt;  /工程路径/abc
        //只有/工程路径/abc下的cookie可以发送给服务器
    
        resp.addCookie(cookie);
        resp.getWriter().write(&quot;创建了一个带有Path路径的Cookie&quot;);
    &#125;
</code></pre>
<h3 id="1-6-Cookie的其他细节"><a href="#1-6-Cookie的其他细节" class="headerlink" title="1.6 Cookie的其他细节"></a>1.6 Cookie的其他细节</h3><ol>
<li><p>一次可不可以发送多个cookie?</p>
<ul>
<li>可以</li>
<li>可以创建多个Cookie对象，使用response调用多次addCookie方法发送cookie即可。</li>
</ul>
</li>
<li><p>cookie能不能存中文？</p>
<ul>
<li>在tomcat 8 之前 cookie中不能直接存储中文数据。<ul>
<li>需要将中文数据转码—一般采用URL编码</li>
</ul>
</li>
<li>在tomcat 8 之后，cookie支持中文数据。特殊字符还是不支持，建议使用URL编码存储，URL解码解析</li>
</ul>
</li>
<li><p>cookie共享问题？</p>
<ol>
<li>假设在一个tomcat服务器中，部署了多个web项目，那么在这些web项目中cookie能不能共享？</li>
</ol>
<ul>
<li>默认情况下cookie不能共享</li>
<li>setPath(String path):设置cookie的获取范围。默认情况下，设置当前的虚拟目录</li>
<li>如果要共享，则可以将path设置为”/“</li>
</ul>
<ol start="2">
<li>不同的tomcat服务器间cookie共享问题？<ul>
<li>setDomain(String path):如果设置一级域名相同，那么多个服务器之间cookie可以共享</li>
<li>setDomain(“.baidu.com”),那么tieba.baidu.com和news.baidu.com中cookie可以共享</li>
</ul>
</li>
</ol>
</li>
<li><p>Cookie的特点和作用</p>
<ol>
<li>cookie存储数据在客户端浏览器</li>
<li>浏览器对于单个cookie 的大小有限制(4kb) 以及对同一个域名下的总cookie数量也有限制(20个)</li>
</ol>
<ul>
<li><p>作用：</p>
<ol>
<li><p>cookie一般用于存储少量的不太敏感的数据</p>
</li>
<li><p>在不登录的情况下，完成服务器对客户端的身份识别</p>
<p>例如：</p>
<pre><code class="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
     String username = req.getParameter(&quot;username&quot;);
     String password = req.getParameter(&quot;password&quot;);

     if (&quot;wzg168&quot;.equals(username) &amp;&amp; &quot;123456&quot;.equals(password)) &#123;
         //登录 成功
         Cookie cookie = new Cookie(&quot;username&quot;, username);
         cookie.setMaxAge(60 * 60 * 24 * 7);//当前Cookie一周内有效
         resp.addCookie(cookie);
         System.out.println(&quot;登录 成功&quot;);
     &#125; else &#123;
//            登录 失败
         System.out.println(&quot;登录 失败&quot;);
     &#125;

 &#125;
</code></pre>
</li>
</ol>
<h2 id="服务器端会话Session"><a href="#服务器端会话Session" class="headerlink" title="服务器端会话Session"></a>服务器端会话Session</h2></li>
</ul>
<h3 id="1-1-概述-1"><a href="#1-1-概述-1" class="headerlink" title="1.1 概述"></a>1.1 概述</h3></li>
</ol>
<p>概念：服务器端会话技术，在一次会话的多次请求间共享数据，将数据保存在服务器端的对象中。HttpSession </p>
<p>Session 就一个接口（HttpSession）。</p>
<p>Session 就是会话。它是用来维护一个客户端和服务器之间关联的一种技术。</p>
<p>每个客户端都有自己的一个 Session 会话。</p>
<p>Session 会话中，我们经常用来保存用户登录之后的信息。</p>
<p>Session的实现是依赖于Cookie的。</p>
<h3 id="1-2-Session创建与获取"><a href="#1-2-Session创建与获取" class="headerlink" title="1.2 Session创建与获取"></a>1.2 Session创建与获取</h3><p>如何创建和获取 Session。它们的 API 是一样的。 </p>
<p><code>request.getSession()</code> 第一次调用是：创建 Session 会话 </p>
<p>之后调用都是：获取前面创建好的 Session 会话对象。</p>
<p><code>isNew();</code> 判断到底是不是刚创建出来的（新的） true 表示刚创建 false 表示获取之前创建</p>
<p>每个会话都有一个身份证号。也就是 ID 值。而且这个 ID 是唯一的。 getId() 得到 Session 的会话 id 值。</p>
<pre><code class="java">//创建
protected void createOrGetSession(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        // 创建和获取Session会话对象
        HttpSession session = req.getSession();
        // 判断 当前Session会话，是否是新创建出来的
        boolean isNew = session.isNew();
        // 获取Session会话的唯一标识 id
        String id = session.getId();
        resp.getWriter().write(&quot;得到的Session，它的id是：&quot; + id + &quot; &lt;br /&gt; &quot;);
        resp.getWriter().write(&quot;这个Session是否是新创建的：&quot; + isNew + &quot; &lt;br /&gt; &quot;);
    &#125;
//设置值
protected void setAttribute(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        req.getSession().setAttribute(&quot;key1&quot;, &quot;value1&quot;);
        resp.getWriter().write(&quot;已经往Session中保存了数据&quot;);

    &#125;
//获取值
protected void getAttribute(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        Object attribute = req.getSession().getAttribute(&quot;key1&quot;);
        resp.getWriter().write(&quot;从Session中获取出key1的数据是：&quot; + attribute);
    &#125;
</code></pre>
<h3 id="1-3-Session生命周期"><a href="#1-3-Session生命周期" class="headerlink" title="1.3 Session生命周期"></a>1.3 Session生命周期</h3><p><code>public void setMaxInactiveInterval(intinterval)</code> 作用：</p>
<ul>
<li><p>设置 Session 的超时时间（以秒为单位），超过指定的时长，Session 就会被销毁。 </p>
</li>
<li><p>值为正数的时候，设定 Session 的超时时长。 负数表示永不超时（极少使用）</p>
</li>
</ul>
<p><code>public int getMaxInactiveInterval()</code>：获取 Session 的超时时间</p>
<p><code>public void invalidate()</code> ：让当前 Session 会话马上超时无效</p>
<p>Session 默认的超时时长是多少！</p>
<ul>
<li><p>Session 默认的超时时间长为 30 分钟。 因为在Tomcat服务器的配置文件web.xml中默认有以下的配置，它就表示配置了当前</p>
<p>Tomcat服务器下所有的Session 超时配置默认时长为：30 分钟。</p>
</li>
</ul>
<pre><code class="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;30&lt;/session-timeout&gt; 
&lt;/session-config&gt;
</code></pre>
<p>如果说。你希望你的 web 工程，默认的 Session 的超时时长为其他时长。你可以在你自己的 web.xml 配置文件中做 以上相同的配置。就</p>
<p>可以修改你的 web 工程所有 Seession 的默认超时时长。 </p>
<p>如果你想只修改个别 Session 的超时时长。就可以使用上面的 API。</p>
<p><code>session.setMaxInactiveInterval(intinterval)</code>来进行单独的设置超时时长</p>
<p>实例代码</p>
<pre><code class="java">protected void life3(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        // 先获取Session对象
        HttpSession session = req.getSession();
        // 设置当前Session3秒后超时
        session.setMaxInactiveInterval(3);

        resp.getWriter().write(&quot;当前Session已经设置为3秒后超时&quot;);
    &#125;

    protected void deleteNow(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        // 先获取Session对象
        HttpSession session = req.getSession();
        // 让Session会话马上超时
        session.invalidate();
        resp.getWriter().write(&quot;Session已经设置为超时（无效）&quot;);
    &#125;
</code></pre>
<h3 id="1-4-浏览器和-Session-之间关联"><a href="#1-4-浏览器和-Session-之间关联" class="headerlink" title="1.4 浏览器和 Session 之间关联"></a>1.4 浏览器和 Session 之间关联</h3><p><img src="/2020/09/23/Cookie&Session/session.jpg" alt="session"></p>
<h3 id="1-5-Session其他细节"><a href="#1-5-Session其他细节" class="headerlink" title="1.5 Session其他细节"></a>1.5 Session其他细节</h3><ol>
<li>当客户端关闭后，服务器不关闭，两次获取session是否为同一个？</li>
</ol>
<ul>
<li><p>默认情况下。不是。</p>
</li>
<li><p>如果需要相同，则可以创建Cookie,键为JSESSIONID，设置最大存活时间，让cookie持久化保存。</p>
<pre><code class="java">Cookie c = new Cookie(&quot;JSESSIONID&quot;,session.getId());
c.setMaxAge(60*60);
response.addCookie(c);
</code></pre>
</li>
</ul>
<ol start="2">
<li>客户端不关闭，服务器关闭后，两次获取的session是同一个吗？</li>
</ol>
<ul>
<li>不是同一个，但是要确保数据不丢失。tomcat自动完成以下工作<ul>
<li>session的钝化：<ul>
<li>在服务器正常关闭之前，将session对象系列化到硬盘上</li>
</ul>
</li>
<li>session的活化：<ul>
<li>在服务器启动后，将session文件转化为内存中的session对象即可。</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>session什么时候被销毁？</li>
</ol>
<ul>
<li>服务器关闭</li>
<li>session默认失效时间 30分钟</li>
</ul>
<ol start="4">
<li>session的特点</li>
</ol>
<ul>
<li>session用于存储一次会话的多次请求的数据，存在服务器端</li>
<li>session可以存储任意类型，任意大小的数据</li>
</ul>
<ol start="5">
<li><p>session与Cookie的区别：</p>
<ul>
<li>session存储数据在服务器端，Cookie在客户端</li>
<li>session没有数据大小限制，Cookie有</li>
<li>session数据安全，Cookie相对于不安全</li>
</ul>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/javaweb/" rel="tag"># javaweb</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/09/22/Request&Response/" rel="prev" title="Request&Response">
                  <i class="fa fa-chevron-left"></i> Request&Response
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/09/24/Filter%E8%BF%87%E6%BB%A4%E5%99%A8&Listener%E7%9B%91%E5%90%AC%E5%99%A8/" rel="next" title="Filter过滤器和Listener监听器">
                  Filter过滤器和Listener监听器 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wyc</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>


    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>















  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  

</body>
</html>
